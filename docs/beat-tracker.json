{
  "v2_analysis_schema": {
    "meta": {
      "version": "v2",
      "script": "scripts/analyze-track-v2.py",
      "purpose": "Описание всех полей, которые вычисляет активный анализатор v2"
    },

    "track_level": {
      "bpm": "INT. Средний темп трека (beats per minute).",
      "duration": "FLOAT. Длительность аудио в секундах.",
      "track_type": "STRING. 'bachata' (2 пика) | 'popsa' (4 пика).",
      "peaks_per_octave": "INT. 2 — бачата, 4 — попса.",
      "song_start_beat": "INT (с 1). Номер бита, с которого начинается активная часть трека.",
      "song_start_time": "FLOAT. Время начала активной части в секундах.",
      "row_swapped": "BOOLEAN. true если истинный РАЗ оказался в ряду 5 (Phase 1 своп).",
      "row1_sum": "FLOAT. Суммарная энергия (RMS) первых initial_quarters_count квадратов ряда РАЗ.",
      "row5_sum": "FLOAT. Суммарная энергия (RMS) первых initial_quarters_count квадратов ряда ПЯТЬ."
    },

    "per_beat_data": {
      "description": "Массив объектов — по одному на каждый бит трека (нумерация с 1).",
      "id": "INT (с 1). Порядковый номер бита.",
      "time": "FLOAT. Временная метка в секундах.",
      "energy": "FLOAT. RMS-энергия (громкость) в окне 80ms вокруг бита — полный спектр.",
      "mel_energy": "FLOAT. Mel-weighted energy в окне 80ms: среднее суммарной мощности по 128 мел-банкам (librosa.melspectrogram). Ближе к восприятию уха, чем plain RMS.",
      "madmom_score": "FLOAT (0.0–1.0). Уверенность нейросети Madmom (RNNDownBeatProcessor), что этот бит — сильная доля (downbeat). Используется только для поиска сильных рядов (Phase 0/1). НЕ используется в квадратном анализе."
    },

    "square_analysis": {
      "description": "Делим трек на равные части (1/1, 1/2×2, 1/3×3, 1/5×5) и сравниваем Row 1 vs Row 5.",
      "verdict": "STRING. 'has_bridges' если хотя бы одна часть красная (по energy). 'square_confirmed' если все зелёные.",
      "row_dominance_pct": "FLOAT. (R1−R5)/R5×100. Положительный = РАЗ доминирует, отрицательный = ПЯТЬ доминирует.",
      "parts": {
        "description": "Ключи: '1/1', '1/2_first', '1/2_second', '1/3_first', ..., '1/5_1' ... '1/5_5'.",
        "row1_energy": "FLOAT. Сумма energy битов ряда 1-4 в этой части.",
        "row5_energy": "FLOAT. Сумма energy битов ряда 5-8 в этой части.",
        "status_energy": "STRING. 'green' если row1_energy > row5_energy, иначе 'red'.",
        "row1_mel": "FLOAT. Сумма mel_energy битов ряда 1-4 в этой части.",
        "row5_mel": "FLOAT. Сумма mel_energy битов ряда 5-8 в этой части.",
        "status_mel": "STRING. 'green' | 'red' по mel_energy — наблюдательный, не влияет на вердикт.",
        "status": "STRING. Итоговый вердикт части — копия status_energy.",
        "time_start": "FLOAT. Время начала части в секундах.",
        "time_end": "FLOAT. Время конца части в секундах."
      }
    },

    "row_analysis": {
      "description": "8 рядов по глобальной сетке (бит i → ряд (i%8)+1). Используется для отображения в UI.",
      "row_N": {
        "count": "INT. Количество битов в этом ряду.",
        "madmom_sum": "FLOAT. Сумма madmom_score по всем битам ряда.",
        "madmom_avg": "FLOAT. Среднее madmom_score.",
        "madmom_max": "FLOAT. Максимальный madmom_score.",
        "madmom_min": "FLOAT. Минимальный madmom_score."
      }
    },

    "quarters": {
      "description": "Массив четвёрок (4 бита) от начала трека. Используются в индикаторах и мостиках.",
      "index": "INT. Порядковый номер четвёрки (0-based).",
      "beat": "INT (с 1). Глобальный номер первого бита четвёрки.",
      "time": "FLOAT. Время первого бита.",
      "energy_sum": "FLOAT. Сумма energy 4 битов.",
      "position": "STRING. '1-4' (ряд РАЗ) | '5-8' (ряд ПЯТЬ) — с учётом подтверждённых мостиков."
    },

    "indicators": {
      "description": "Биты-кандидаты на мостик: probability 100% = локальный минимум energy в окне ±4 тактов.",
      "beat": "INT (с 1). Номер бита.",
      "time_sec": "FLOAT. Время в секундах.",
      "quarter_index": "INT. Индекс четвёрки.",
      "position": "STRING. '1-4' | '5-8'.",
      "action": "STRING. Решение: 'bridge_confirmed' | 'ignored_break' | 'ignored_same_square' | 'ignored_small_diff' | 'ignored_no_change' | 'not_processed'.",
      "reason": "STRING. Пояснение решения.",
      "row1_sum": "FLOAT (только для подтверждённых). Сумма energy ряда 1 в следующем квадрате.",
      "row5_sum": "FLOAT (только для подтверждённых). Сумма energy ряда 5 в следующем квадрате.",
      "diff_pct": "FLOAT. Разница рядов в % от большего."
    },

    "bridges": {
      "description": "Подтверждённые мостики — точки смены доминирования рядов.",
      "beat": "INT (с 1). Бит начала мостика.",
      "time_sec": "FLOAT. Время в секундах.",
      "quarter_index": "INT. Индекс четвёрки.",
      "row1_sum": "FLOAT. Сумма energy ряда 1 в квадрате после мостика.",
      "row5_sum": "FLOAT. Сумма energy ряда 5 в квадрате после мостика.",
      "diff_pct": "FLOAT. Разница рядов в %."
    },

    "layout": {
      "description": "Финальная раскладка рядов — сегменты для плеера. Читается в lib/beatGrid.ts.",
      "from_beat": "INT (с 1). Первый бит сегмента.",
      "to_beat": "INT (с 1). Последний бит сегмента.",
      "time_start": "FLOAT. Время начала сегмента в секундах.",
      "time_end": "FLOAT. Время конца сегмента в секундах.",
      "row1_start": "INT. 1 или 5 — с какого счёта начинается ряд РАЗ в этом сегменте."
    }
  }
}
