# Исправление проблемы с озвучиванием счета

## Проблема

Трек с BPM 111 озвучивался странно - как будто через один (1, 3, 5, 7), иногда слышно на фоне 2.

## Причина

Madmom определял downbeats (сильные доли) слишком часто - почти каждый beat, а не каждый второй beat, как должно быть в бачате.

В бачате:
- Downbeats должны быть каждый второй beat (1, 3, 5, 7)
- Между downbeats должны быть промежуточные beats (2, 4, 6, 8)
- Интервал между downbeats = 2 * (60 / BPM)

Но madmom возвращал downbeats с интервалом ~0.54 секунды (каждый beat), а не ~1.08 секунды (каждый второй beat).

## Решение

Добавлена фильтрация downbeats в функции `generateBeatGridFromDownbeats` в `lib/beatGrid.ts`:

1. **Проверка частоты downbeats**: Если интервал между downbeats меньше 1.5 * beatInterval, значит madmom определил слишком много downbeats.

2. **Фильтрация**: Оставляем только те downbeats, интервал между которыми близок к ожидаемому (>= 70% от expectedDownbeatInterval).

3. **Генерация промежуточных beats**: После фильтрации правильно добавляются промежуточные beats (2, 4, 6, 8) между downbeats (1, 3, 5, 7).

## Результат

- Downbeats фильтруются правильно (например, с 331 до 167 для трека с BPM 111)
- BeatGrid генерируется с правильной последовательностью 1-8
- Озвучивание счета работает корректно

## Тестирование

Для проверки исправления можно использовать скрипт:
```bash
npx tsx scripts/test-beatgrid-fix.ts
```

Этот скрипт покажет:
- Количество downbeats до и после фильтрации
- Первые 20 beats в beatGrid
- Распределение номеров beats
- Проверку последовательности beats

